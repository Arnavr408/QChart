<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Stock Chart</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <style>
        #chart-container {
            width: 100vw;
            height: 90vh;
            transition: all 0.3s ease;
        }

        #tradingview-chart {
            width: 100%;
            height: 100%;
        }
    </style>
    <!-- Standard favicon -->
<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="icon" type="image/png" sizes="48x48" href="favicon-48x48.png">

<!-- Apple Touch Icons (for iOS home screen) -->
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">

<!-- Favicon.ico fallback -->
<link rel="shortcut icon" href="favicon.ico">

</head>
<body>
    <button id="go-back">⬅️ Back</button>

    <div id="time">Loading...</div>

    <div id="input-container">
        <input type="text" id="stock-symbol" placeholder="symbol">
        <button id="submit-symbol">Submit</button>
    </div>

    <div id="chart-container">
        <iframe id="tradingview-chart" src="" frameborder="0"></iframe>
    </div>

    <footer>
        <p>Stock Data Powered by TradingView</p>
    </footer>

    <script>
        document.getElementById("go-back").addEventListener("click", () => {
            window.location.href = "index.html";
        });
    
        async function updateClock() {
            try {
                const userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
                const response = await fetch(`https://www.timeapi.io/api/Time/current/zone?timeZone=${userTimeZone}`);
                const data = await response.json();
    
                const now = new Date(data.dateTime);
                let hours = now.getHours();
                let minutes = now.getMinutes();
                let ampm = hours >= 12 ? "PM" : "AM";
    
                hours = hours % 12 || 12;
                minutes = minutes < 10 ? "0" + minutes : minutes;
    
                document.getElementById("time").textContent = `${hours}:${minutes} ${ampm}`;
            } catch (error) {
                console.error("Failed to fetch time:", error);
            }
        }
    
        updateClock();
        setInterval(updateClock, 5000);
    
        function loadChart(symbol) {
            document.getElementById("tradingview-chart").src = `https://s.tradingview.com/widgetembed/?symbol=${symbol}&interval=1&theme=dark&style=1`;
        }
    
        const urlSymbol = new URLSearchParams(window.location.search).get("symbol") || "AAPL";
        loadChart(urlSymbol);
    
        document.getElementById("submit-symbol").addEventListener("click", () => {
            const newSymbol = document.getElementById("stock-symbol").value.toUpperCase();
            if (newSymbol) {
                loadChart(newSymbol);
            }
        });
    
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js")
                .then(() => console.log("Service Worker Registered"))
                .catch((error) => console.log("Service Worker Registration Failed", error));
        }
    </script>
</body>
</html>
